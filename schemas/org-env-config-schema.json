{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "TXO Org/Env Config Schema (v3.1)",
  "type": "object",
  "required": [
    "global",
    "script-behavior",
    "business-central"
  ],
  "properties": {
    "global": {
      "type": "object",
      "required": [
        "api-base-url",
        "api-version",
        "tenant-id",
        "client-id",
        "oauth-scope"
      ],
      "properties": {
        "api-base-url": {
          "type": "string",
          "format": "uri"
        },
        "api-version": {
          "type": "string",
          "enum": [
            "v2.0",
            "v2",
            "v1.0"
          ]
        },
        "tenant-id": {
          "type": "string",
          "minLength": 1
        },
        "client-id": {
          "type": "string",
          "minLength": 1
        },
        "oauth-scope": {
          "type": "string",
          "minLength": 1
        }
      },
      "additionalProperties": true
    },
    "business-central": {
      "type": "object",
      "required": [
        "environment-name",
        "companies",
        "apis"
      ],
      "properties": {
        "environment-name": {
          "type": "string",
          "minLength": 1
        },
        "companies": {
          "type": "array",
          "items": {
            "type": "string",
            "minLength": 1
          },
          "minItems": 1
        },
        "apis": {
          "type": "array",
          "items": {
            "type": "string",
            "minLength": 1
          },
          "minItems": 1
        }
      },
      "additionalProperties": false
    },
    "script-behavior": {
      "type": "object",
      "required": [
        "excel-output-filename",
        "api-delay-seconds",
        "api-timeouts",
        "retry-strategy",
        "jitter",
        "rate-limiting",
        "circuit-breaker",
        "batch-handling",
        "enable-progress-bars",
        "debug-mode",
        "verbose-logging"
      ],
      "properties": {
        "excel-output-filename": {
          "type": "string",
          "pattern": "^.+\\.xlsx$"
        },
        "api-delay-seconds": {
          "type": "number",
          "minimum": 0
        },
        "api-timeouts": {
          "type": "object",
          "required": [
            "rest-timeout-seconds",
            "soap-timeout-seconds",
            "wsdl-timeout-seconds",
            "async-max-wait",
            "async-poll-interval"
          ],
          "properties": {
            "rest-timeout-seconds": {
              "type": "integer",
              "minimum": 1
            },
            "soap-timeout-seconds": {
              "type": "integer",
              "minimum": 1
            },
            "wsdl-timeout-seconds": {
              "type": "integer",
              "minimum": 1
            },
            "async-max-wait": {
              "type": "integer",
              "minimum": 0
            },
            "async-poll-interval": {
              "type": "integer",
              "minimum": 1
            }
          },
          "additionalProperties": false
        },
        "retry-strategy": {
          "type": "object",
          "required": [
            "max-retries",
            "backoff-factor"
          ],
          "properties": {
            "max-retries": {
              "type": "integer",
              "minimum": 0
            },
            "backoff-factor": {
              "type": "number",
              "minimum": 0
            }
          },
          "additionalProperties": false
        },
        "jitter": {
          "type": "object",
          "required": [
            "min-factor",
            "max-factor"
          ],
          "properties": {
            "min-factor": {
              "type": "number"
            },
            "max-factor": {
              "type": "number"
            }
          },
          "additionalProperties": false
        },
        "rate-limiting": {
          "type": "object",
          "required": [
            "enabled",
            "calls-per-second",
            "burst-size"
          ],
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "calls-per-second": {
              "type": "number",
              "minimum": 0
            },
            "burst-size": {
              "type": "number",
              "minimum": 0
            }
          },
          "additionalProperties": false
        },
        "circuit-breaker": {
          "type": "object",
          "required": [
            "enabled",
            "failure-threshold",
            "timeout-seconds"
          ],
          "properties": {
            "enabled": {
              "type": "boolean"
            },
            "failure-threshold": {
              "type": "integer",
              "minimum": 1
            },
            "timeout-seconds": {
              "type": "integer",
              "minimum": 1
            }
          },
          "additionalProperties": false
        },
        "batch-handling": {
          "type": "object",
          "required": [
            "read-batch-size",
            "update-batch-size",
            "vat-batch-size"
          ],
          "properties": {
            "read-batch-size": {
              "type": "integer",
              "minimum": 1
            },
            "update-batch-size": {
              "type": "integer",
              "minimum": 1
            },
            "vat-batch-size": {
              "type": "integer",
              "minimum": 1
            }
          },
          "additionalProperties": false
        },
        "enable-progress-bars": {
          "type": "boolean"
        },
        "debug-mode": {
          "type": "boolean"
        },
        "verbose-logging": {
          "type": "boolean"
        }
      },
      "additionalProperties": true
    }
  },
  "additionalProperties": false
}